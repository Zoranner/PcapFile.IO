# PCAP文件UDP广播工具

这是一个用于将PCAP数据文件内容通过UDP广播的工具，可以按照原始数据包的时间间隔进行播放，适用于数据流重放场景。现已增强功能，支持目录处理、多线程读写和大文件处理。

## 功能特点

- 支持读取PCAP格式的数据文件
- 支持处理目录中的所有PCAP文件
- 通过UDP广播发送数据包内容
- 多线程读写分离，提高性能
- 大文件支持，分批读取避免内存溢出
- 保持原始数据包时间间隔（可调整播放速度）
- 支持配置广播地址和端口
- 提供实时监控和详细的统计信息
- 可配置缓冲区大小，优化性能
- 使用PcapFile.IO库中定义的标准缓冲区大小和参数

## 使用方法

### 基本使用

广播单个PCAP文件:

```bash
PcapFile.IO.UdpBroadcaster <PCAP文件路径>
```

广播目录中的所有PCAP文件:

```bash
PcapFile.IO.UdpBroadcaster <PCAP目录路径>
```

### 高级选项

指定广播地址和端口:

```bash
PcapFile.IO.UdpBroadcaster <PCAP文件路径> -a 192.168.1.255 -p 8888
```

调整播放速度(2倍速):

```bash
PcapFile.IO.UdpBroadcaster <PCAP文件路径> -s 2
```

调整缓冲区大小（提高性能）:

```bash
PcapFile.IO.UdpBroadcaster <PCAP文件路径> -b 200
```

显示详细统计信息:

```bash
PcapFile.IO.UdpBroadcaster <PCAP文件路径> --stats
```

详细模式（显示更多日志）:

```bash
PcapFile.IO.UdpBroadcaster <PCAP文件路径> -v
```

组合使用多个参数:

```bash
PcapFile.IO.UdpBroadcaster <PCAP目录路径> -a 192.168.1.255 -p 8888 -s 2 -b 200 --stats
```

## 命令行参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `-a, --address <IP地址>` | 指定广播地址 | 255.255.255.255 |
| `-p, --port <端口>` | 指定广播端口 | 12345 |
| `-s, --speed <倍速>` | 播放速度倍数 | 1 |
| `-b, --buffer <大小>` | 缓冲区大小(数据包数量) | 100 |
| `-v, --verbose` | 显示详细日志信息 | 否 |
| `--stats` | 显示详细统计信息 | 否 |

## 构建方法

```bash
dotnet build
```

## 依赖项

- .NET 6.0或.NET 8.0
- PcapFile.IO库

## 使用场景

- 重放网络流量进行测试
- 分布式系统模拟数据输入
- 测试数据接收端处理能力
- 演示和教学场景
- 性能测试和压力测试

## 技术原理

1. **多线程读写分离**：使用生产者-消费者模式，读取和发送分离到不同线程
2. **缓冲区管理**：使用阻塞集合实现线程安全的数据包队列
3. **大文件支持**：分批读取数据包，避免全部载入内存
4. **实时统计**：提供包括吞吐量、队列大小等实时统计信息
5. **标准化配置**：使用PcapFile.IO库中定义的标准配置参数
6. **时间控制**：根据数据包时间戳计算发送间隔
7. **UDP广播**：通过UDP广播发送数据包内容

## 高级设计特点

1. **自适应缓冲区**：通过命令行参数可以调整队列大小，根据系统性能调优
2. **异步IO操作**：利用.NET的异步IO提高性能和响应性
3. **资源管理**：正确实现IDisposable模式，确保资源释放
4. **错误处理**：健壮的异常处理，确保高可靠性
5. **可扩展架构**：模块化设计，便于添加新功能和扩展
6. **标准兼容**：与PcapFile.IO库兼容，使用标准的配置参数和缓冲区大小

## 注意事项

- 本工具不修改数据包内容，原样转发
- 播放速度参数控制发送间隔，但不改变数据包本身
- 使用广播需要确保网络环境支持广播通信
- 默认广播地址(255.255.255.255)可能在某些网络环境中受限
- 处理大型PCAP文件时可能需要调整缓冲区大小以获得最佳性能 